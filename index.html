<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dating Quiz 18+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- CORE STYLES --- */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000;
            position: fixed; /* Фиксируем body, скролл внутри wrapper */
            inset: 0;
            width: 100%;
            height: 100%;
        }

        /* Убираем синюю подсветку при тапе */
        * { -webkit-tap-highlight-color: transparent; }

        /* --- ANIMATIONS --- */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-btn { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }

        .pulse-green { animation: pulse-green-anim 2s infinite; }
        @keyframes pulse-green-anim {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        /* --- GLASSMOPRHISM --- */
        .glass-panel {
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8); 
        }

        /* --- UI ELEMENTS --- */
        .lang-link {
            position: relative;
            opacity: 0.7;
            transition: all 0.2s;
            cursor: pointer;
            padding: 4px;
        }
        .lang-link:hover, .lang-link.active-country {
            opacity: 1;
            color: #ef4444;
            font-weight: 800;
        }
        .lang-switch-btn {
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.6;
            font-weight: 600;
            padding: 4px;
        }
        .lang-switch-btn.active { opacity: 1; color: #ef4444; }

        /* --- QUIZ SPECIFIC --- */
        .progress-bar-container {
            background: rgba(255,255,255,0.1);
            border-radius: 99px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #ef4444, #f97316);
            transition: width 0.5s ease;
        }
        
        /* Loading Animation items */
        .processing-item {
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s;
        }
        .processing-item.active { opacity: 1; transform: translateX(0); }
        .processing-item.done { opacity: 0.5; color: #22c55e; }

        /* --- CHAT CSS --- */
        .chat-scroll-container {
            mask-image: linear-gradient(to bottom, transparent, black 5%, black 95%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 5%, black 95%, transparent);
            overflow: hidden;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        .chat-message-new {
            animation: messageSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .online-dot {
            box-shadow: 0 0 5px #22c55e;
            animation: pulse-green-dot 2s infinite;
        }
        @keyframes pulse-green-dot {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .chat-toast {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background-color: rgba(220, 38, 38, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s;
            z-index: 100;
            width: 90%;
            text-align: center;
        }
        .chat-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <!-- VIDEO BACKGROUND (Layer 0) -->
    <div class="fixed inset-0 overflow-hidden z-0 bg-black pointer-events-none">
        <video id="bg-video" autoplay muted loop playsinline poster="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=1964" class="w-full h-full object-cover">
            <source src="background.mp4" type="video/mp4">
        </video>
        <div class="absolute inset-0 bg-gradient-to-r from-black/95 via-black/70 to-black/40 z-10"></div>
    </div>

    <!-- HEADER (Layer 50) -->
    <div class="absolute top-0 left-0 w-full z-50 p-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 pointer-events-none">
        <!-- RU/EN -->
        <div class="flex gap-3 text-sm font-bold tracking-widest pointer-events-auto bg-black/40 backdrop-blur-md px-4 py-2 rounded-full border border-white/10 shadow-lg">
            <span onclick="setLang('ru')" id="lang-ru" class="lang-switch-btn active">RU</span>
            <span class="text-gray-500">|</span>
            <span onclick="setLang('en')" id="lang-en" class="lang-switch-btn">EN</span>
        </div>
        <!-- Countries -->
        <div class="flex flex-wrap justify-end gap-x-4 gap-y-2 max-w-[280px] md:max-w-[400px] text-xs font-bold tracking-widest pointer-events-auto bg-black/30 backdrop-blur-md p-3 rounded-xl border border-white/5">
            <span onclick="setLang('de')" class="lang-link">AT</span>
            <span onclick="setLang('fr')" class="lang-link">BE</span>
            <span onclick="setLang('fr')" class="lang-link">FR</span>
            <span onclick="setLang('de')" class="lang-link">DE</span>
            <span onclick="setLang('it')" class="lang-link">IT</span>
            <span onclick="setLang('nl')" class="lang-link">NL</span>
            <span onclick="setLang('pl')" class="lang-link">PL</span>
            <span onclick="setLang('es')" class="lang-link">ES</span>
            <span onclick="setLang('sv')" class="lang-link">SE</span>
            <span onclick="setLang('de')" class="lang-link">CH</span>
        </div>
    </div>

    <!-- MAIN SCROLL WRAPPER (Layer 40) - ГАРАНТИЯ РАБОТЫ НА МОБИЛЬНЫХ -->
    <div class="absolute inset-0 z-40 overflow-y-auto overflow-x-hidden touch-pan-y">
        
        <!-- FLEX CONTAINER -->
        <!-- pt-32 pb-32: большие отступы, чтобы контент не перекрывался браузером -->
        <div class="min-h-full flex flex-col md:flex-row items-center justify-center pt-32 pb-32 px-4 gap-8 md:gap-16">
            
            <!-- LEFT COLUMN: DYNAMIC VIEWS -->
            <div id="content-area" class="w-full max-w-sm md:max-w-md flex-shrink-0 relative">
                
                <!-- 1. AGE GATE -->
                <div id="view-age-gate" class="glass-panel p-6 md:p-8 rounded-2xl text-center border-t-4 border-red-600 fade-in">
                    <div class="w-16 h-16 mx-auto mb-6 rounded-full bg-red-600/20 flex items-center justify-center border border-red-500 shadow-[0_0_20px_rgba(220,38,38,0.5)]">
                        <span class="text-xl font-black text-white">18+</span>
                    </div>
                    <h1 id="txt-title" class="text-2xl md:text-3xl font-black mb-3 uppercase tracking-wide">
                        Только <span class="text-red-500">Взрослые</span>
                    </h1>
                    <p id="txt-subtitle" class="text-gray-300 text-xs mb-8 font-medium leading-relaxed">
                        Этот сайт содержит материалы 18+.<br>Вы подтверждаете свой возраст?
                    </p>
                    <div class="flex flex-col gap-3 relative z-50">
                        <button onclick="gotoChoice()" class="w-full bg-gradient-to-r from-red-700 to-red-600 text-white font-bold py-4 rounded-xl uppercase tracking-wider text-lg shadow-lg pulse-btn active:scale-95 transition-transform">
                            <span id="btn-yes">Да, мне есть 18</span>
                        </button>
                        <button onclick="exitSite()" class="w-full bg-transparent border border-gray-600 text-gray-400 hover:text-white py-3 rounded-xl uppercase text-xs">
                            <span id="btn-no">Нет, выход</span>
                        </button>
                    </div>
                </div>

                <!-- 2. CHOICE (Quiz vs Skip) -->
                <div id="view-choice" class="hidden glass-panel p-6 md:p-8 rounded-2xl text-center border-t-4 border-blue-500 fade-in">
                    <h2 id="txt-choice-title" class="text-xl md:text-2xl font-black mb-2 uppercase text-white">Выберите путь</h2>
                    <p id="txt-choice-sub" class="text-gray-300 text-xs mb-8">Как вы хотите продолжить?</p>
                    
                    <button onclick="startQuiz()" class="w-full mb-4 relative overflow-hidden bg-gradient-to-r from-blue-700 to-blue-600 p-5 rounded-xl text-left border border-blue-400/30 active:scale-95 transition-transform shadow-lg">
                        <div class="relative z-10">
                            <div class="text-[10px] text-blue-200 font-bold uppercase mb-1 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-blue-300 animate-pulse"></span>
                                <span id="txt-rec">Рекомендуется</span>
                            </div>
                            <div id="btn-choice-quiz" class="text-lg font-bold uppercase">Подобрать пару</div>
                            <div id="txt-choice-quiz-desc" class="text-[10px] text-blue-100 opacity-80 mt-1">Пройти тест на совместимость (30 сек)</div>
                        </div>
                    </button>

                    <button onclick="redirectSmartlink()" class="w-full bg-black/40 border border-gray-600 p-4 rounded-xl text-left active:bg-gray-800 transition-colors">
                        <div id="btn-choice-skip" class="text-sm font-bold text-gray-300 uppercase">Пропустить и смотреть анкеты</div>
                        <div class="text-[10px] text-gray-500 mt-1">Качество совпадений может быть ниже</div>
                    </button>
                </div>

                <!-- 3. QUIZ (3 Questions) -->
                <div id="view-quiz" class="hidden glass-panel p-6 rounded-2xl border-t-4 border-orange-500 fade-in relative">
                    <div class="w-full h-1.5 progress-bar-container mb-6">
                        <div id="quiz-progress" class="h-full progress-bar-fill" style="width: 33%"></div>
                    </div>

                    <div id="quiz-content">
                        <h3 id="quiz-question" class="text-xl font-bold mb-6 text-center min-h-[4rem] flex items-center justify-center">
                            <!-- Question Text Here -->
                        </h3>
                        <div id="quiz-options" class="flex flex-col gap-3">
                            <!-- JS Generated Buttons -->
                        </div>
                    </div>
                </div>

                <!-- 4. PROCESSING (Animation) -->
                <div id="view-processing" class="hidden glass-panel p-8 rounded-2xl text-center border-t-4 border-green-500 fade-in">
                    <div class="w-16 h-16 mx-auto mb-6 relative">
                        <div class="absolute inset-0 border-4 border-gray-600 rounded-full opacity-30"></div>
                        <div class="absolute inset-0 border-4 border-t-green-500 rounded-full animate-spin"></div>
                    </div>
                    <div id="process-log" class="text-left text-xs font-mono text-green-400 bg-black/50 p-4 rounded-lg h-32 flex flex-col justify-end overflow-hidden mb-4 border border-green-900/50">
                        <!-- JS Logs -->
                    </div>
                    <p id="txt-analyzing" class="text-sm font-bold animate-pulse text-white">Анализ анкет...</p>
                </div>

                <!-- 5. RESULT (Final) -->
                <div id="view-result" class="hidden glass-panel p-6 md:p-8 rounded-2xl text-center border-t-4 border-red-600 fade-in">
                    <div class="mb-6">
                        <div class="inline-block px-4 py-1 rounded-full bg-green-500/20 text-green-400 text-[10px] font-bold border border-green-500/50 mb-4 animate-bounce">
                            <span id="txt-match-found">УСПЕХ! СОВПАДЕНИЕ НАЙДЕНО</span>
                        </div>
                        <h2 id="txt-ready" class="text-2xl md:text-3xl font-black uppercase mb-2">Анкета Готова</h2>
                        <p id="txt-ready-sub" class="text-gray-300 text-xs">Мы подобрали девушек по вашим параметрам.</p>
                    </div>

                    <div class="p-4 bg-black/40 rounded-xl mb-6 border border-gray-700">
                        <div class="flex items-center justify-between text-xs text-gray-400 mb-2">
                            <span id="txt-criteria-age">Возраст:</span> <span class="text-white">OK</span>
                        </div>
                        <div class="flex items-center justify-between text-xs text-gray-400 mb-2">
                            <span id="txt-criteria-goal">Цель:</span> <span class="text-white">OK</span>
                        </div>
                        <div class="flex items-center justify-between text-xs text-gray-400">
                            <span id="txt-criteria-loc">Локация:</span> <span class="text-green-400 font-bold">Рядом (1 км)</span>
                        </div>
                    </div>

                    <button onclick="redirectSmartlink()" class="w-full bg-gradient-to-r from-green-600 to-green-500 text-white font-bold py-4 rounded-xl uppercase tracking-wider text-lg md:text-xl shadow-[0_0_20px_rgba(34,197,94,0.4)] pulse-green active:scale-95 transition-transform">
                        <span id="btn-show">Показать Партнера</span>
                    </button>
                </div>

            </div>

            <!-- RIGHT COLUMN: CHAT (Hidden on Mobile) -->
            <div id="live-chat" class="hidden md:flex glass-panel w-80 rounded-2xl fade-in z-10 border-r-4 border-r-green-500/50 flex-shrink-0 h-[500px] flex-col">
                <div class="p-4 border-b border-white/10 flex items-center justify-between bg-black/20 rounded-t-2xl">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-green-500 online-dot"></div>
                        <span id="txt-chat-title" class="text-sm font-bold tracking-wide">LIVE ONLINE</span>
                    </div>
                    <span class="text-xs text-gray-400 bg-white/10 px-2 py-0.5 rounded-full">4,209</span>
                </div>

                <div class="chat-scroll-container p-2 relative flex-grow">
                    <div id="chat-track" class="flex flex-col justify-end gap-2 pb-2"></div>
                </div>
                
                <div class="p-3 border-t border-white/10 bg-black/20 rounded-b-2xl relative">
                    <div id="chat-toast" class="chat-toast"><span id="txt-chat-alert">Подтвердите возраст!</span></div>
                    <div onclick="tryChat()" class="h-8 bg-white/5 rounded-full border border-white/10 flex items-center px-3 cursor-pointer hover:bg-white/10">
                        <span id="txt-chat-placeholder" class="text-[10px] text-gray-500 italic">Написать...</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        const SMARTLINK_URL = "https://tone.affomelody.com/click?pid=40187&offer_id=25";
        const FALLBACK_URL = "https://t.me/the_serp_real";

        /* --- STATE --- */
        var currentLang = 'ru';
        var quizStep = 0;

        /* --- TRANSLATIONS --- */
        // Renamed 't' to 'translations' to avoid conflicts
        const translations = {
            ru: {
                title: 'Только <span class="text-red-500">Взрослые</span>',
                subtitle: 'Этот сайт содержит материалы 18+.<br>Вы подтверждаете свой возраст?',
                btnYes: 'Да, мне есть 18',
                btnNo: 'Нет, выход',
                // Choice
                choiceTitle: 'Выберите путь',
                choiceSub: 'Как вы хотите продолжить?',
                rec: 'Рекомендуется',
                btnChoiceQuiz: 'Подобрать пару',
                btnChoiceQuizDesc: 'Пройти тест на совместимость (30 сек)',
                btnChoiceSkip: 'Пропустить и смотреть анкеты',
                // Quiz
                q1: 'Ваш возраст?',
                q1_opt1: '18 - 25 лет',
                q1_opt2: '25 - 40 лет',
                q1_opt3: '40+ лет',
                q2: 'Какая ваша цель?',
                q2_opt1: 'Серьезные отношения',
                q2_opt2: 'Просто общение',
                q2_opt3: 'Секс / Развлечения',
                q3: 'Важен ли внешность?',
                q3_opt1: 'Да, очень важна',
                q3_opt2: 'Нет, главное харизма',
                // Process
                analyzing: 'Анализ совместимости...',
                logs: ['Подключение к базе...', 'Фильтрация ботов...', 'Анализ геолокации...', 'Подбор кандидатов...', 'Готово!'],
                // Result
                matchFound: 'УСПЕХ! СОВПАДЕНИЕ НАЙДЕНО',
                ready: 'Анкета Готова',
                readySub: 'Мы подобрали девушек по вашим параметрам.',
                critAge: 'Возраст:',
                critGoal: 'Цель:',
                critLoc: 'Локация:',
                btnShow: 'Показать Партнера',
                // Chat
                chatTitle: 'LIVE СЕЙЧАС',
                chatPlaceholder: 'Войдите, чтобы ответить...',
                chatAlert: 'Сначала пройдите проверку!'
            },
            en: {
                title: 'Adults <span class="text-red-500">Only</span>',
                subtitle: 'This site contains 18+ material.<br>Do you confirm your age?',
                btnYes: 'Yes, I am 18+',
                btnNo: 'No, Exit',
                choiceTitle: 'Choose Path',
                choiceSub: 'How do you want to proceed?',
                rec: 'Recommended',
                btnChoiceQuiz: 'Find a Match',
                btnChoiceQuizDesc: 'Take compatibility quiz (30s)',
                btnChoiceSkip: 'Skip to Photos',
                q1: 'Your Age?',
                q1_opt1: '18 - 25 years',
                q1_opt2: '25 - 40 years',
                q1_opt3: '40+ years',
                q2: 'Your Goal?',
                q2_opt1: 'Serious Relationship',
                q2_opt2: 'Just Chatting',
                q2_opt3: 'Fun / Casual / Sex',
                q3: 'Looks Matter?',
                q3_opt1: 'Yes, very much',
                q3_opt2: 'No, vibe is key',
                analyzing: 'Analyzing compatibility...',
                logs: ['Connecting to DB...', 'Filtering bots...', 'Checking geolocation...', 'Matching profiles...', 'Done!'],
                matchFound: 'SUCCESS! MATCH FOUND',
                ready: 'Profile Ready',
                readySub: 'We found girls matching your preferences.',
                critAge: 'Age:',
                critGoal: 'Goal:',
                critLoc: 'Location:',
                btnShow: 'Show Partner',
                chatTitle: 'LIVE NOW',
                chatPlaceholder: 'Login to reply...',
                chatAlert: 'Verify age first!'
            }
        };

        // Fallback languages (copy EN to others)
        ['de', 'fr', 'it', 'nl', 'pl', 'es', 'sv'].forEach(l => translations[l] = translations.en);
        // Небольшой перевод для немецкого для примера
        translations.de = {
            ...translations.en,
            title: 'Nur <span class="text-red-500">Erwachsene</span>',
            btnYes: 'Ja, ich bin 18+',
            btnNo: 'Nein',
            choiceTitle: 'Wähle den Weg',
            btnChoiceQuiz: 'Partner finden',
            btnChoiceSkip: 'Überspringen'
        };

        /* --- LOGIC FLOW --- */
        function setLang(lang) {
            currentLang = lang;
            
            document.querySelectorAll('.lang-switch-btn').forEach(el => el.classList.remove('active'));
            const btn = document.getElementById(`lang-${lang === 'ru' ? 'ru' : 'en'}`);
            if(btn) btn.classList.add('active');

            const dict = translations[lang];
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if(el) el.innerHTML = text;
            };

            // Main
            setText('txt-title', dict.title);
            setText('txt-subtitle', dict.subtitle);
            setText('btn-yes', dict.btnYes);
            setText('btn-no', dict.btnNo);
            // Choice
            setText('txt-choice-title', dict.choiceTitle);
            setText('txt-choice-sub', dict.choiceSub);
            setText('txt-rec', dict.rec);
            setText('btn-choice-quiz', dict.btnChoiceQuiz);
            setText('txt-choice-quiz-desc', dict.btnChoiceQuizDesc);
            setText('btn-choice-skip', dict.btnChoiceSkip);
            // Result
            setText('txt-analyzing', dict.analyzing);
            setText('txt-match-found', dict.matchFound);
            setText('txt-ready', dict.ready);
            setText('txt-ready-sub', dict.readySub);
            setText('txt-criteria-age', dict.critAge);
            setText('txt-criteria-goal', dict.critGoal);
            setText('txt-criteria-loc', dict.critLoc);
            setText('btn-show', dict.btnShow);
            // Chat
            setText('txt-chat-title', dict.chatTitle);
            setText('txt-chat-placeholder', dict.chatPlaceholder);
            setText('txt-chat-alert', dict.chatAlert);

            if(quizStep > 0 && quizStep <= 3) renderQuizStep(quizStep);
            
            // Restart chat in new language
            document.getElementById('chat-track').innerHTML = ''; 
            startChat();
        }

        // NAVIGATION
        function gotoChoice() {
            document.getElementById('view-age-gate').classList.add('hidden');
            document.getElementById('view-choice').classList.remove('hidden');
        }

        function startQuiz() {
            document.getElementById('view-choice').classList.add('hidden');
            document.getElementById('view-quiz').classList.remove('hidden');
            quizStep = 1;
            renderQuizStep(1);
        }

        function renderQuizStep(step) {
            const dict = translations[currentLang];
            const qEl = document.getElementById('quiz-question');
            const optsEl = document.getElementById('quiz-options');
            const progress = document.getElementById('quiz-progress');

            optsEl.innerHTML = ''; 

            let qText = '';
            let options = [];

            if (step === 1) {
                qText = dict.q1;
                options = [dict.q1_opt1, dict.q1_opt2, dict.q1_opt3];
                progress.style.width = '33%';
            } else if (step === 2) {
                qText = dict.q2;
                options = [dict.q2_opt1, dict.q2_opt2, '<span class="text-red-400 font-bold">' + dict.q2_opt3 + '</span>'];
                progress.style.width = '66%';
            } else if (step === 3) {
                qText = dict.q3;
                options = [dict.q3_opt1, dict.q3_opt2];
                progress.style.width = '100%';
            }

            qEl.innerHTML = qText;

            options.forEach((opt) => {
                const btn = document.createElement('button');
                btn.className = "w-full bg-white/10 hover:bg-white/20 border border-white/10 p-4 rounded-xl text-left text-sm font-bold text-white transition-colors flex items-center justify-between group active:scale-95";
                btn.innerHTML = `<span>${opt}</span> <div class="w-4 h-4 rounded-full border border-gray-400 group-hover:bg-red-500 group-hover:border-red-500 transition-colors"></div>`;
                btn.onclick = () => nextStep();
                optsEl.appendChild(btn);
            });
        }

        function nextStep() {
            quizStep++;
            if (quizStep > 3) {
                startProcessing();
            } else {
                setTimeout(() => renderQuizStep(quizStep), 150);
            }
        }

        function startProcessing() {
            document.getElementById('view-quiz').classList.add('hidden');
            document.getElementById('view-processing').classList.remove('hidden');
            
            const logContainer = document.getElementById('process-log');
            const logs = translations[currentLang].logs;
            let i = 0;
            const interval = setInterval(() => {
                if (i >= logs.length) {
                    clearInterval(interval);
                    setTimeout(showResult, 800);
                    return;
                }
                const div = document.createElement('div');
                div.className = 'processing-item active text-[10px] md:text-xs mb-1';
                div.innerText = `> ${logs[i]}`;
                logContainer.appendChild(div);
                if(i > 0) logContainer.children[i-1].classList.add('done');
                i++;
            }, 500);
        }

        function showResult() {
            document.getElementById('view-processing').classList.add('hidden');
            document.getElementById('view-result').classList.remove('hidden');
        }

        function redirectSmartlink() {
            window.location.href = SMARTLINK_URL;
        }

        function exitSite() {
            window.location.href = FALLBACK_URL;
        }

        /* --- CHAT SYSTEM (Women Only Avatars) --- */
        const chatNames = ["Alice", "Elena", "Katy", "Masha", "Vika", "Anna"];
        const chatMsgs = {
            ru: ["Привет!", "Кто тут?", "Скучно...", "Ищу парня", "Есть кто 30+?"],
            en: ["Hi!", "Anyone here?", "So bored...", "Looking for fun", "Hey guys"]
        };

        var chatTimeout;
        function startChat() {
            const track = document.getElementById('chat-track');
            clearTimeout(chatTimeout);
            // Add initial messages if empty
            if (track.children.length === 0) {
                for(let i=0; i<3; i++) addMsg(false);
            }
            loopChat();
        }

        function loopChat() {
            chatTimeout = setTimeout(() => {
                addMsg(true);
                loopChat();
            }, Math.random() * 3000 + 2000);
        }

        function addMsg(animate) {
            const msgs = chatMsgs[currentLang] || chatMsgs.en;
            const msg = msgs[Math.floor(Math.random() * msgs.length)];
            const name = chatNames[Math.floor(Math.random() * chatNames.length)];
            const avatarId = Math.floor(Math.random() * 95); // Women only ID
            const avatarUrl = `https://randomuser.me/api/portraits/women/${avatarId}.jpg`;
            
            const div = document.createElement('div');
            div.className = `chat-message flex items-center gap-3 p-2 rounded-lg cursor-default ${animate ? 'chat-message-new' : ''} bg-white/5 mb-2`;
            
            div.innerHTML = `
                <div class="relative flex-shrink-0">
                    <img src="${avatarUrl}" class="w-8 h-8 rounded-full object-cover border border-white/20">
                    <div class="absolute bottom-0 right-0 w-2 h-2 bg-green-500 rounded-full border border-black"></div>
                </div>
                <div class="flex flex-col overflow-hidden">
                    <span class="text-[10px] font-bold text-red-400">${name}</span>
                    <span class="text-[10px] text-gray-200 truncate">${msg}</span>
                </div>
            `;
            const track = document.getElementById('chat-track');
            track.appendChild(div);
            if(track.children.length > 5) track.removeChild(track.children[0]);
        }

        function tryChat() {
            const toast = document.getElementById('chat-toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        window.onload = function() {
            setLang('ru');
        }
    </script>
</body>
</html>
